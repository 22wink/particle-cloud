<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <title>手势星云爱心</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div id="overlay">
      <!-- <div class="title">手势粒子爱心</div> -->
      <div class="hint">张开手掌：放大成星云 · 捏合手掌：爱心收缩</div>
      <div class="status" id="status">等待摄像头授权...</div>
    </div>
    <video id="video" autoplay playsinline muted></video>
    <div id="webgl-container"></div>
    <script>
      // 设置 MediaPipe 资源路径（必须在所有 MediaPipe 脚本之前）
      // 确保在全局作用域中设置，让所有脚本都能访问
      (function() {
        // 获取基础路径（处理 GitHub Pages 子路径）
        var pathname = window.location.pathname;
        var lastSlash = pathname.lastIndexOf('/');
        var basePath = lastSlash >= 0 ? pathname.substring(0, lastSlash + 1) : '/';
        
        // 确保 Module 对象在全局作用域中存在
        if (typeof Module === 'undefined') {
          window.Module = {};
        }
        
        // 设置 locateFile 函数，确保资源文件路径正确
        // 这个函数会被 hands_solution_packed_assets_loader.js 调用
        Module.locateFile = function(file, prefix) {
          // 如果文件已经在 libs/mediapipe/ 路径中，直接使用
          if (file.indexOf('libs/mediapipe/') === 0) {
            return basePath + file;
          }
          // 否则添加 libs/mediapipe/ 前缀
          var fullPath = basePath + 'libs/mediapipe/' + file;
          console.log('[MediaPipe] locateFile:', file, '->', fullPath);
          return fullPath;
        };
        
        // 设置 locateFilePackage（旧版本兼容）
        Module.locateFilePackage = Module.locateFilePackage || Module.locateFile;
        
        console.log('[MediaPipe] Module.locateFile configured, basePath:', basePath);
      })();
    </script>
    <script src="./libs/mediapipe/camera_utils.js"></script>
    <script src="./libs/mediapipe/hands.js"></script>
    <script src="./libs/mediapipe/hands_solution_packed_assets_loader.js"></script>
    <script src="./libs/mediapipe/hands_solution_simd_wasm_bin.js"></script>
    <script type="module" src="./main.js"></script>
  </body>
</html>

