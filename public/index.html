<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <title>æ‰‹åŠ¿æ˜Ÿäº‘çˆ±å¿ƒ</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ’•</text></svg>" />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div id="overlay">
      <!-- <div class="title">æ‰‹åŠ¿ç²’å­çˆ±å¿ƒ</div> -->
      <div class="hint">å¼ å¼€æ‰‹æŒï¼šæ”¾å¤§æˆæ˜Ÿäº‘ Â· æåˆæ‰‹æŒï¼šçˆ±å¿ƒæ”¶ç¼©</div>
      <div class="status" id="status">ç­‰å¾…æ‘„åƒå¤´æˆæƒ...</div>
    </div>
    <video id="video" autoplay playsinline muted></video>
    <div id="webgl-container"></div>
    <script>
      // è®¾ç½® MediaPipe èµ„æºè·¯å¾„ï¼ˆå¿…é¡»åœ¨æ‰€æœ‰ MediaPipe è„šæœ¬ä¹‹å‰ï¼‰
      // ç¡®ä¿åœ¨å…¨å±€ä½œç”¨åŸŸä¸­è®¾ç½®ï¼Œè®©æ‰€æœ‰è„šæœ¬éƒ½èƒ½è®¿é—®
      (function() {
        // è·å–åŸºç¡€è·¯å¾„ï¼ˆå¤„ç† GitHub Pages å­è·¯å¾„ï¼‰
        var pathname = window.location.pathname;
        var lastSlash = pathname.lastIndexOf('/');
        var basePath = lastSlash >= 0 ? pathname.substring(0, lastSlash + 1) : '/';
        
        // ç«‹å³åˆ›å»ºå…¨å±€ Module å¯¹è±¡ï¼ˆä¸ä½¿ç”¨ window.Moduleï¼Œç›´æ¥ä½¿ç”¨ Moduleï¼‰
        window.Module = window.Module || {};
        // ç¡®ä¿ Module åœ¨å…¨å±€ä½œç”¨åŸŸä¸­ï¼ˆä¸ä½¿ç”¨ varï¼Œç›´æ¥èµ‹å€¼ï¼‰
        if (typeof Module === 'undefined') {
          this.Module = window.Module;
        } else {
          Module = window.Module;
        }
        
        // è®¾ç½® locateFile å‡½æ•°ï¼Œç¡®ä¿èµ„æºæ–‡ä»¶è·¯å¾„æ­£ç¡®
        // è¿™ä¸ªå‡½æ•°ä¼šè¢« hands_solution_packed_assets_loader.js è°ƒç”¨
        var locateFileFunc = function(file, prefix) {
          // å¦‚æœæ–‡ä»¶å·²ç»åœ¨ libs/mediapipe/ è·¯å¾„ä¸­ï¼Œç›´æ¥ä½¿ç”¨
          if (file.indexOf('libs/mediapipe/') === 0) {
            return basePath + file;
          }
          // å¦åˆ™æ·»åŠ  libs/mediapipe/ å‰ç¼€
          var fullPath = basePath + 'libs/mediapipe/' + file;
          console.log('[MediaPipe] locateFile called:', file, 'prefix:', prefix, '->', fullPath);
          return fullPath;
        };
        
        // ç›´æ¥è®¾ç½®åˆ°å…¨å±€ Moduleï¼ˆä¸ä½¿ç”¨ window.Moduleï¼‰
        Module.locateFile = locateFileFunc;
        Module.locateFilePackage = locateFileFunc;
        window.Module = Module;
        
        // éªŒè¯è®¾ç½®
        console.log('[MediaPipe] Module.locateFile configured, basePath:', basePath);
        console.log('[MediaPipe] Module object:', typeof Module);
        console.log('[MediaPipe] Module.locateFile:', typeof Module.locateFile);
        console.log('[MediaPipe] window.Module.locateFile:', typeof window.Module.locateFile);
        
        // æµ‹è¯•è°ƒç”¨
        var testPath = Module.locateFile('test.data', '');
        console.log('[MediaPipe] Test locateFile call:', testPath);
      })();
    </script>
    <script>
      // åœ¨åŠ è½½ MediaPipe è„šæœ¬å‰å†æ¬¡éªŒè¯ Module.locateFile
      (function() {
        if (typeof Module === 'undefined' || typeof Module.locateFile !== 'function') {
          console.error('[MediaPipe] ERROR: Module.locateFile not set before loading scripts!');
        } else {
          console.log('[MediaPipe] Module.locateFile verified before loading scripts');
        }
      })();
    </script>
    <script>
      // å…³é”®ï¼šåœ¨ hands_solution_packed_assets_loader.js åŠ è½½å‰è®¾ç½® createMediapipeSolutionsPackedAssets
      // å› ä¸ºè¯¥è„šæœ¬ä¼šæ£€æŸ¥ createMediapipeSolutionsPackedAssets å¹¶ä½¿ç”¨å®ƒæ¥åˆ›å»º Module
      (function() {
        var pathname = window.location.pathname;
        var lastSlash = pathname.lastIndexOf('/');
        var basePath = lastSlash >= 0 ? pathname.substring(0, lastSlash + 1) : '/';
        
        // åˆ›å»º createMediapipeSolutionsPackedAssets å¯¹è±¡ï¼ŒåŒ…å« locateFile
        window.createMediapipeSolutionsPackedAssets = window.createMediapipeSolutionsPackedAssets || {};
        window.createMediapipeSolutionsPackedAssets.locateFile = function(file, prefix) {
          if (file.indexOf('libs/mediapipe/') === 0) {
            return basePath + file;
          }
          var fullPath = basePath + 'libs/mediapipe/' + file;
          console.log('[MediaPipe] locateFile called (via createMediapipeSolutionsPackedAssets):', file, '->', fullPath);
          return fullPath;
        };
        window.createMediapipeSolutionsPackedAssets.locateFilePackage = window.createMediapipeSolutionsPackedAssets.locateFile;
        
        console.log('[MediaPipe] createMediapipeSolutionsPackedAssets configured');
      })();
    </script>
    <script src="./libs/mediapipe/camera_utils.js"></script>
    <script src="./libs/mediapipe/hands.js"></script>
    <script src="./libs/mediapipe/hands_solution_packed_assets_loader.js"></script>
    <script>
      // åœ¨ hands_solution_packed_assets_loader.js åŠ è½½åç«‹å³é‡æ–°è®¾ç½® Module.locateFile
      // å› ä¸ºè¯¥è„šæœ¬ä¼šé‡æ–°å®šä¹‰ Module å¯¹è±¡ï¼Œè¦†ç›–æˆ‘ä»¬çš„è®¾ç½®
      (function() {
        var pathname = window.location.pathname;
        var lastSlash = pathname.lastIndexOf('/');
        var basePath = lastSlash >= 0 ? pathname.substring(0, lastSlash + 1) : '/';
        
        // é‡æ–°è®¾ç½® locateFileï¼ˆhands_solution_packed_assets_loader.js ä¼šé‡æ–°å®šä¹‰ Moduleï¼‰
        if (typeof Module !== 'undefined') {
          Module.locateFile = function(file, prefix) {
            if (file.indexOf('libs/mediapipe/') === 0) {
              return basePath + file;
            }
            var fullPath = basePath + 'libs/mediapipe/' + file;
            console.log('[MediaPipe] locateFile called (after script load):', file, '->', fullPath);
            return fullPath;
          };
          Module.locateFilePackage = Module.locateFile;
          console.log('[MediaPipe] Module.locateFile re-configured after hands_solution_packed_assets_loader.js');
        }
      })();
    </script>
    <script src="./libs/mediapipe/hands_solution_simd_wasm_bin.js"></script>
    <script>
      // æœ€ç»ˆéªŒè¯
      (function() {
        console.log('[MediaPipe] Final check - Module.locateFile:', typeof Module !== 'undefined' && typeof Module.locateFile);
        if (typeof Module !== 'undefined' && Module.locateFile) {
          var test = Module.locateFile('test.data', '');
          console.log('[MediaPipe] Final test:', test);
        }
      })();
    </script>
    <script type="module" src="./main.js"></script>
  </body>
</html>

